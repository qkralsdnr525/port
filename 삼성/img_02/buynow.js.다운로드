function crawlingBuyDirect(mdlCode){buyDirect(mdlCode,"_self")}
function buyDirect(mdlCode,target){if(mdlCode===null||mdlCode===undefined||$.trim(mdlCode).length==0){var alertData={title:"",content:"모델코드가 없습니다.",callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false}var goodsId;var option={url:"/sec/xhr/bespoke/goodsIdsAjax",dataType:"json",type:"POST",async:false,data:{bspkGrpKeys:mdlCode},success:function(result){if(result.exCode!==null&&result.exCode!==undefined){var alertData={title:"",content:"상품을 준비중입니다.",callBack:"",btnText:"확인"};
commonAlert(alertData);openLayer("commonAlert");return false}else if(result.goodsIdList!=null)goodsId=result.goodsIdList[0]},error:function(response,status,error){var alertData={title:"",content:"오류",callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false},beforeSend:function(xhr){xhr.setRequestHeader("ajax",true)},complete:function(){}};$.ajax(option);if(goodsId!==null&&goodsId!==undefined){var reqData={goodsIds:goodsId,stGbCd:"${view.stGbCd}",stId:"${view.stId}",mbrNo:"${session.mbrNo}",
nowBuyYn:"Y",buyQtys:1,orderType:"ONCE"};var nowBuyOptions={url:"/sec/xhr/order/insertCart",dataType:"json",type:"POST",data:reqData,success:function(result){if(result.exCode!==null&&result.exCode!==undefined){var alertData={title:"",content:result.exMsg,callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false}else{var form=document.createElement("form");form.setAttribute("action","/sec/order/");form.setAttribute("target",target);form.setAttribute("method","post");document.body.appendChild(form);
form.submit()}},error:function(response,status,error){var alertData={title:"",content:"오류",callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false},beforeSend:function(xhr){xhr.setRequestHeader("ajax",true)},complete:function(){}};$.ajax(nowBuyOptions)}}
function fnBuyDirect(mdlList){console.log("mdlList 222222=====> "+JSON.stringify(mdlList));var searchMdlParams="";var searchCompNoParams="";var qtyList=new Array;var tradeInList=new Array;if(0<mdlList.length){var mdlCodeI="";var qtyI=0;var compNoI="";var content="";var goodsOrdTpCd="";var bespokeYnI="";var bspkPannelCodeI="";var bspkPannelCodeListI="";for(var i=0;i<mdlList.length;i++){mdlCodeI=mdlList[i].mdlCode;qtyI=mdlList[i].qty;if(mdlList[i].compNo===null||mdlList[i].compNo===undefined||$.trim(mdlList[i].compNo).length==
0)compNoI=0;else compNoI=mdlList[i].compNo;if(mdlList[i].bespokeYn===null||mdlList[i].bespokeYn===undefined)bespokeYnI="N";else bespokeYnI=mdlList[i].bespokeYn;if(mdlCodeI===null||mdlCodeI===undefined||$.trim(mdlCodeI).length==0)if(bespokeYnI=="Y")content="모델이 선택되지 않았습니다.<br/>선택 완료 후 구매해 주시기 바랍니다.";else content="모델코드를 확인하여 주시기 바랍니다.";if(qtyI===null||qtyI===undefined||qtyI<1)content="수량을 확인하여 주시기 바랍니다.";if(bespokeYnI=="Y"){bspkPannelCodeI=mdlList[i].pannelCode;bspkPannelCodeListI=mdlList[i].pannelCode.split("|");
var mdlOptions={url:"/sec/xhr/bespoke/bespokeModelType",dataType:"json",type:"POST",async:false,data:{mdlCode:mdlCodeI},success:function(result){var oneDoorTypeSeq=["4","5","6","8"];var twoDoorTypeSeq=["3"];var threeDoorTypeSeq=["7","9","21"];var pannelReqLength=0;if(oneDoorTypeSeq.indexOf(result.typeSeq)>-1)pannelReqLength=1;else if(twoDoorTypeSeq.indexOf(result.typeSeq)>-1)pannelReqLength=2;else if(threeDoorTypeSeq.indexOf(result.typeSeq)>-1)pannelReqLength=3;else pannelReqLength=4;if(bspkPannelCodeListI==
""||bspkPannelCodeListI==undefined||bspkPannelCodeListI==null)content="컬러가 선택되지 않았습니다.<br/>선택 완료 후 구매해 주시기 바랍니다.";else if(bspkPannelCodeListI.length<pannelReqLength)content="모든 컬러가 선택되지 않았습니다.<br/>선택 완료 후 구매해 주시기 바랍니다.";if(content!==""){var alertData={title:"",content:content,callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false}else{var bspkCodes=mdlCodeI+"|"+bspkPannelCodeI;buyfixedMatchAjax(bspkCodes,qtyI,"buy","")}return false},error:function(){var alertData={title:"",
content:"데이터 확인이 필요합니다.",callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false}};$.ajax(mdlOptions);return false}else{mdlList[i].pannelCode="";bspkPannelCodeI=mdlList[i].pannelCode;bspkPannelCodeListI=mdlList[i].pannelCode.split("|");var isChk=true;if(mdlList[i].tradeIn=="Y"){goodsOrdTpCd="TRD";isChk=chkLoginFn()}else goodsOrdTpCd="";if(!isChk)return false;console.log("goodsOrdTpCd=====> "+goodsOrdTpCd);if(content!==""){var alertData={title:"",content:content,callBack:"",
btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false}else{if(i!==mdlList.length-1){searchMdlParams+=mdlCodeI+"^";searchCompNoParams+=compNoI+"^"}else{searchMdlParams+=mdlCodeI;searchCompNoParams+=compNoI}qtyList.push(qtyI);tradeInList.push(goodsOrdTpCd)}}}}else{var alertData={title:"",content:"데이터 확인이 필요합니다.",callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false}var goodsIdList=[];var option={url:"/sec/xhr/bespoke/goodsIdsAjax",dataType:"json",
type:"POST",async:false,data:{bspkGrpKeys:searchMdlParams,compNos:searchCompNoParams},success:function(result){if(result.exCode!==null&&result.exCode!==undefined){var alertData={title:"goodsIdsAjax",content:result.exMsg,callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false}else if(result.goodsIdList!==null)goodsIdList=result.goodsIdList},error:function(response,status,error){var alertData={title:"goodsIdsAjax.err",content:"오류",callBack:"",btnText:"확인"};commonAlert(alertData);
openLayer("commonAlert");return false},beforeSend:function(xhr){xhr.setRequestHeader("ajax",true)},complete:function(){}};$.ajax(option);if(goodsIdList!==null&&goodsIdList!==undefined&&goodsIdList.length>0){var reqData={goodsIds:String(goodsIdList),stGbCd:"${view.stGbCd}",stId:"${view.stId}",mbrNo:"${session.mbrNo}",nowBuyYn:"Y",buyQtys:String(qtyList),orderType:"ONCE",goodsOrdTpCd:String(tradeInList)};var nowBuyOptions={url:"/sec/xhr/order/insertCart",dataType:"json",type:"POST",data:reqData,success:function(result){if(result.exCode!==
null&&result.exCode!==undefined){var alertData={title:"insertCart",content:result.exMsg,callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false}else{var form=document.createElement("form");form.setAttribute("action","/sec/order/");form.setAttribute("target","_self");form.setAttribute("method","post");document.body.appendChild(form);form.submit()}},error:function(response,status,error){var alertData={title:"insertCart.err",content:"오류",callBack:"",btnText:"확인"};commonAlert(alertData);
openLayer("commonAlert");return false},beforeSend:function(xhr){xhr.setRequestHeader("ajax",true)},complete:function(){}};$.ajax(nowBuyOptions)}}
var buyAjax=function(data){var ids="";var option1={url:"/sec/xhr/bespoke/goodsIdsAjax",dataType:"json",type:"POST",async:false,data:{bspkGrpKeys:data},success:function(result){if(typeof result.exCode!=="undefined"){var alertData={title:"",content:"상품을 준비중입니다.",callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false}else ids=JSON.stringify(result.goodsIdList)},error:function(response,status,error){alert("오류");return false},beforeSend:function(xhr){xhr.setRequestHeader("ajax",
true)},complete:function(){}};$.ajax(option1);if(ids!=""){var option={url:"/sec/xhr/order/insertCart",dataType:"json",type:"POST",data:{nowBuyYn:"Y",bspkGrpKeys:data,goodsIds:ids},success:function(result){if(typeof result.exCode!=="undefined"){var alertData={title:"",content:result.exMsg,callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false}else{var form=document.createElement("form");form.setAttribute("action","/sec/order/");form.setAttribute("target","_self");form.setAttribute("method",
"post");document.body.appendChild(form);form.submit()}},error:function(response,status,error){alert("오류")},beforeSend:function(xhr){xhr.setRequestHeader("ajax",true)},complete:function(){}};$.ajax(option)}};
function fnCartDirect(mdlList,cartCallMethod){console.log("mdlList=====> "+JSON.stringify(mdlList));var searchMdlParams="";var searchCompNoParams="";var qtyList=new Array;if(0<mdlList.length){var mdlCodeI="";var qtyI=0;var compNoI="";var content="";var bespokeYnI="";var bspkPannelCodeI="";var bspkPannelCodeListI="";for(var i=0;i<mdlList.length;i++){mdlCodeI=mdlList[i].mdlCode;qtyI=mdlList[i].qty;if(mdlList[i].compNo===null||mdlList[i].compNo===undefined||$.trim(mdlList[i].compNo).length==0)compNoI=
0;else compNoI=mdlList[i].compNo;if(mdlList[i].bespokeYn===null||mdlList[i].bespokeYn===undefined)bespokeYnI="N";else bespokeYnI=mdlList[i].bespokeYn;if(mdlCodeI===null||mdlCodeI===undefined||$.trim(mdlCodeI).length==0)if(bespokeYnI=="Y")content="모델이 선택되지 않았습니다.<br/>선택 완료 후 구매해 주시기 바랍니다.";else content="모델코드를 확인하여 주시기 바랍니다.";if(qtyI===null||qtyI===undefined||qtyI<1)content="수량을 확인하여 주시기 바랍니다.";if(bespokeYnI=="Y"){bspkPannelCodeI=mdlList[i].pannelCode;bspkPannelCodeListI=mdlList[i].pannelCode.split("|");
var mdlOptions={url:"/sec/xhr/bespoke/bespokeModelType",dataType:"json",type:"POST",async:false,data:{mdlCode:mdlCodeI},success:function(result){var oneDoorTypeSeq=["4","5","6","8"];var twoDoorTypeSeq=["3"];var threeDoorTypeSeq=["7","9","21"];var pannelReqLength=0;if(oneDoorTypeSeq.indexOf(result.typeSeq)>-1)pannelReqLength=1;else if(twoDoorTypeSeq.indexOf(result.typeSeq)>-1)pannelReqLength=2;else if(threeDoorTypeSeq.indexOf(result.typeSeq)>-1)pannelReqLength=3;else pannelReqLength=4;if(bspkPannelCodeListI==
""||bspkPannelCodeListI==undefined||bspkPannelCodeListI==null)content="컬러가 선택되지 않았습니다.<br/>선택 완료 후 구매해 주시기 바랍니다.";else if(bspkPannelCodeListI.length<pannelReqLength)content="모든 컬러가 선택되지 않았습니다.<br/>선택 완료 후 구매해 주시기 바랍니다.";if(content!==""){var alertData={title:"",content:content,callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false}else{var bspkCodes=mdlCodeI+"|"+bspkPannelCodeI;buyfixedMatchAjax(bspkCodes,qtyI,"cart",cartCallMethod)}return false},error:function(){var alertData=
{title:"",content:"데이터 확인이 필요합니다.",callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false}};$.ajax(mdlOptions);return false}else{mdlList[i].pannelCode="";bspkPannelCodeI=mdlList[i].pannelCode;bspkPannelCodeListI=mdlList[i].pannelCode.split("|");if(content!==""){var alertData={title:"",content:content,callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false}else{if(i!==mdlList.length-1){searchMdlParams+=mdlCodeI+"^";searchCompNoParams+=
compNoI+"^"}else{searchMdlParams+=mdlCodeI;searchCompNoParams+=compNoI}qtyList.push(qtyI)}}}}else{var alertData={title:"",content:"데이터 확인이 필요합니다.",callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false}getGoodsIds(searchMdlParams,searchCompNoParams,qtyList,cartCallMethod)}
function chkLoginFn(){var ret=false;var options2={url:"/sec/xhr/goods/loginCheck",type:"POST",async:false,done:function(data){if(!data.isLogin){ret=false;var alertData={title:"",content:"로그인 후 트레이드인 바로구매가 가능합니다. 로그인 후 다시 시도해주세요",callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert")}else ret=true}};ajax.call(options2);return ret}
function getGoodsIds(searchMdlParams,searchCompNoParams,qtyList,cartCallMethod){var goodsIdList=[];var option={url:"/sec/xhr/bespoke/goodsIdsAjax",dataType:"json",type:"POST",async:false,data:{bspkGrpKeys:searchMdlParams,compNos:searchCompNoParams},success:function(result){if(result.exCode!==null&&result.exCode!==undefined){var alertData={title:"",content:result.exMsg,callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false}else{if(result.goodsIdList!==null)goodsIdList=
result.goodsIdList;goodsCntCart(goodsIdList,qtyList,cartCallMethod)}},error:function(response,status,error){var alertData={title:"",content:"오류",callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false},beforeSend:function(xhr){xhr.setRequestHeader("ajax",true)},complete:function(){}};$.ajax(option)}
function goodsCntCart(goodsIdList,qtyList,cartCallMethod){if(goodsIdList!==null&&goodsIdList!==undefined&&goodsIdList.length>0){var reqData={goodsIds:String(goodsIdList),stGbCd:"${view.stGbCd}",stId:"${view.stId}",mbrNo:"${session.mbrNo}",nowBuyYn:"N",buyQtys:String(qtyList),orderType:"ONCE"};if(cartCallMethod=="confirm"){var options={url:"/sec/xhr/order/goodscnt",data:reqData,done:function(data){var cartCnt=data.goodsCnt;if(cartCnt>0){var confirmData={content:"이미 동일한 상품이 장바구니에 있습니다.</br>추가하시겠습니까?",
okBtnText:"확인",cancelBtnText:"취소"};commonConfirm(confirmData);openLayer("commonConfirm");$("#closeCommonConfirmBtn").css("display","none");$("#commonConfirmOkBtn").on("click",function(){if($("#commonConfirmOkBtn").text()=="확인")insertCartItemFn(reqData,cartCallMethod)});$("#commonConfirmCancelBtn").on("click",function(){return false})}else insertCartItemFn(reqData,cartCallMethod)}};ajax.call(options)}else insertCartItemFn(reqData,cartCallMethod)}}
function insertCartItemFn(reqData,cartCallMethod){var nowBuyOptions={url:"/sec/xhr/order/insertCart",dataType:"json",type:"POST",data:reqData,async:false,success:function(result){if(result.exCode!==null&&result.exCode!==undefined){var alertData={title:"",content:result.exMsg,callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false}else{if(cartCallMethod=="confirm"){var confirmData={content:"제품이 장바구니에 추가되었습니다.<br>장바구니로 이동하시겠습니까?",okBtnText:"이동",cancelBtnText:"취소"};commonConfirm(confirmData);
openLayer("commonConfirm");$("#closeCommonConfirmBtn").css("display","none");$("#commonConfirmOkBtn").on("click",function(){if($("#commonConfirmOkBtn").text()=="이동")location.href="/sec/cart/"});$("#commonConfirmCancelBtn").on("click",function(){return false})}else location.href="/sec/cart/";return false}},error:function(response,status,error){var alertData={title:"",content:"오류",callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false},beforeSend:function(xhr){xhr.setRequestHeader("ajax",
true)},complete:function(){}};$.ajax(nowBuyOptions);return false}
var buyfixedMatchAjax=function(dataParam,qtyList,type,cartCallMethod){var self_=this;var fixedmodel="";var yesCallback=function(){buyAjax(fixedmodel+":::1")};dataParam=dataParam.replace(/\|/g,"^");var noCallback=function(){buyAjax(dataParam)};var coCallback=function(){};var params={"storeCd":"sec","productCode":+dataParam};var option={url:"/sec/xhr/bespoke/fixedMatchAjax",dataType:"json",type:"POST",data:params,jsonpCallback:"jsonpcallback_bespoke",success:function(rtnjson){var price1="0";var price2=
"0";if(rtnjson.fixedMatchResult.code=="Y"){fixedmodel=rtnjson.fixedMatchResult.data.fixedMdl;price1=controlNumber.numberWithCommas(selectPrice);price2=controlNumber.numberWithCommas(rtnjson.fixedMatchResult.data.bPrice);popup.confirm8(1,"가격비교 안내 및 fixed 제품 구매",price1,price2,yesCallback,noCallback,coCallback);return false}else if(type=="cart")cartAjax(dataParam,qtyList,cartCallMethod);else buyAjax(dataParam)},error:function(response,status,error){alert("fixedMatchAjax.오류")},beforeSend:function(xhr){xhr.setRequestHeader("ajax",
true)},complete:function(){}};$.ajax(option)};
var cartAjax=function(data,qtyList,cartCallMethod){var cartParam="";var ids="";var option1={url:"/sec/xhr/bespoke/goodsIdsAjax",dataType:"json",type:"POST",async:false,data:{bspkGrpKeys:data},success:function(result){if(typeof result.exCode!=="undefined"){var alertData={title:"",content:"상품을 준비중입니다.",callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false}else ids=JSON.stringify(result.goodsIdList)},error:function(response,status,error){alert("오류");return false},beforeSend:function(xhr){xhr.setRequestHeader("ajax",
true)},complete:function(){}};$.ajax(option1);goodsIdsTmp=ids.replace(/"/g,"");goodsIdsTmp=goodsIdsTmp.replace("[","");goodsIdsTmp=goodsIdsTmp.replace("]","");var bspkGoodsIdsList=goodsIdsTmp.split(",");if(cartCallMethod=="confirm"){var options={url:"/sec/xhr/order/goodscnt",data:{goodsIds:bspkGoodsIdsList,nowBuyYn:"N",buyQtys:String(qtyList),orderType:"ONCE",bspkGrpKeys:data,bspkGoodsYn:"Y"},done:function(resData){var cartCnt=resData.goodsCnt;if(cartCnt>0){var confirmData={content:"이미 동일한 상품이 장바구니에 있습니다.</br>추가하시겠습니까?",
okBtnText:"확인",cancelBtnText:"취소"};commonConfirm(confirmData);openLayer("commonConfirm");$("#closeCommonConfirmBtn").css("display","none");$("#commonConfirmOkBtn").on("click",function(){if($("#commonConfirmOkBtn").text()=="확인")insertBespokeCartFn(data,ids,cartCallMethod)});$("#commonConfirmCancelBtn").on("click",function(){return false})}else insertBespokeCartFn(data,ids,cartCallMethod)}};ajax.call(options)}else insertBespokeCartFn(data,ids,cartCallMethod)};
var insertBespokeCartFn=function(data,ids,cartCallMethod){if(ids!=""){var option={url:"/sec/xhr/order/insertCart",dataType:"json",type:"POST",data:{nowBuyYn:"N",bspkGrpKeys:data,goodsIds:ids},success:function(result){if(typeof result.exCode!=="undefined"){var alertData={title:"",content:result.exMsg,callBack:"",btnText:"확인"};commonAlert(alertData);openLayer("commonAlert");return false}else{if(cartCallMethod=="confirm"){var confirmData={content:"제품이 장바구니에 추가되었습니다.<br>장바구니로 이동하시겠습니까?",okBtnText:"이동",
cancelBtnText:"취소"};commonConfirm(confirmData);openLayer("commonConfirm");$("#closeCommonConfirmBtn").css("display","none");$("#commonConfirmOkBtn").on("click",function(){if($("#commonConfirmOkBtn").text()=="이동")location.href="/sec/cart/"});$("#commonConfirmCancelBtn").on("click",function(){return false})}else location.href="/sec/cart/";return false}},error:function(response,status,error){alert("오류")},beforeSend:function(xhr){xhr.setRequestHeader("ajax",true)},complete:function(){}};$.ajax(option)}};
